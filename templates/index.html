<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Downloader</title>

<style>
    body {
        font-family: Arial, sans-serif;
        transition: 0.4s;
        background: var(--bg);
        color: var(--text);
    }

    :root {
        --bg: #ffffff;
        --text: #000000;
        --box: #f0f0f0;
    }

    .dark {
        --bg: #121212;
        --text: #ffffff;
        --box: #2a2a2a;
    }

    .container {
        width: 420px;
        margin: 60px auto;
        background: var(--box);
        padding: 25px;
        border-radius: 10px;
        text-align: center;
    }

    input, select {
        width: 90%;
        padding: 10px;
        margin-top: 12px;
        border-radius: 6px;
        border: 1px solid gray;
    }

    button {
        padding: 10px 20px;
        background: green;
        color: white;
        border: none;
        border-radius: 8px;
        margin-top: 20px;
        cursor: pointer;
    }

    .theme-btn {
        background: purple;
        float: right;
        margin: 10px;
    }

    .progress {
        width: 90%;
        background: #ccc;
        height: 20px;
        border-radius: 6px;
        overflow: hidden;
        margin: 15px auto;
    }

    .progress-fill {
        height: 100%;
        width: 0%;
        background: green;
        transition: width 0.2s;
    }
</style>

</head>
<body>

<button id="themeBtn" class="theme-btn">Theme</button>

<div class="container">
    <h2>YouTube Video Downloader</h2>

    <input id="url" type="text" placeholder="Paste YouTube URL">

    <select id="resolution">
        <option>Select Resolution</option>
    </select>

    <div class="progress">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <p id="percent">0%</p>

    <button onclick="startDownload()">Download</button>
</div>

<script>

// Theme Toggle
document.getElementById("themeBtn").onclick = () => {
    document.body.classList.toggle("dark");
};

// Auto load resolutions when URL changes
document.getElementById("url").addEventListener("input", () => {
    let url = document.getElementById("url").value;

    fetch("/video_info", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "url=" + url
    })
    .then(res => res.json())
    .then(data => {
        let r = document.getElementById("resolution");
        r.innerHTML = "";

        if (data.resolutions) {
            data.resolutions.forEach(res => {
                let opt = document.createElement("option");
                opt.value = res;
                opt.innerHTML = res;
                r.appendChild(opt);
            });
        } else {
            r.innerHTML = "<option>Error</option>";
        }
    });
});


// Update Progress
function updateProgress() {
    fetch("/progress")
        .then(res => res.json())
        .then(data => {
            document.getElementById("percent").innerText = data.percentage + "%";
            document.getElementById("progressFill").style.width = data.percentage + "%";
        });
}

// Start Download
function startDownload() {
    let url = document.getElementById("url").value;
    let res = document.getElementById("resolution").value;

    let form = new FormData();
    form.append("url", url);
    form.append("resolution", res);

    setInterval(updateProgress, 500);

    fetch("/download", { method: "POST", body: form })
        .then(res => res.blob())
        .then(file => {
            let a = document.createElement("a");
            a.href = window.URL.createObjectURL(file);
            a.download = "video.mp4";
            a.click();
        });
}

</script>

</body>
</html>
