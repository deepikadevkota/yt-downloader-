<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Downloader</title>

<style>
    body {
        font-family: Arial, sans-serif;
        transition: 0.4s;
        background: var(--bg);
        color: var(--text);
    }

    :root {
        --bg: #ffffff;
        --text: #000000;
        --box: #f0f0f0;
    }

    .dark {
        --bg: #121212;
        --text: #ffffff;
        --box: #2a2a2a;
    }

    .container {
        width: 520px;        /* Bigger Box */
        margin: 50px auto;
        background: var(--box);
        padding: 35px;       /* More padding */
        border-radius: 18px;
        text-align: center;
        box-shadow: 0px 0px 12px #0002;
    }

    input, select {
        width: 95%;
        padding: 12px;
        margin-top: 16px;
        border-radius: 8px;
        border: 1px solid gray;
        font-size: 15px;
    }

    button {
        padding: 12px 25px;
        background: green;
        color: white;
        border: none;
        border-radius: 10px;
        margin-top: 25px;
        cursor: pointer;
        font-size: 16px;
    }

    .theme-btn {
        background: purple;
        float: right;
        margin: 10px;
    }

    .progress {
        width: 95%;
        background: #ccc;
        height: 25px;
        border-radius: 6px;
        overflow: hidden;
        margin: 20px auto;
    }

    .progress-fill {
        height: 100%;
        width: 0%;
        background: green;
        transition: width 0.2s;
    }

    #percent {
        font-size: 18px;
        margin-top: 10px;
    }
</style>

</head>
<body>

<button id="themeBtn" class="theme-btn">Theme</button>

<div class="container">
    <h2>YouTube Video Downloader</h2>

    <input id="url" type="text" placeholder="Paste YouTube URL">

    <select id="resolution">
        <option>Select Resolution</option>
    </select>

    <div class="progress">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <p id="percent">0%</p>

    <button onclick="startDownload()">Download</button>
</div>

<script>

// Theme Toggle
document.getElementById("themeBtn").onclick = () => {
    document.body.classList.toggle("dark");
};

// Load resolutions when URL is entered
document.getElementById("url").addEventListener("input", () => {
    let url = document.getElementById("url").value;
    if (!url.trim()) return;

    fetch("/video_info", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: "url=" + encodeURIComponent(url)
    })
    .then(res => res.json())
    .then(data => {
        let r = document.getElementById("resolution");
        r.innerHTML = "";

        if (data.resolutions && data.resolutions.length > 0) {
            data.resolutions.forEach(res => {
                let opt = document.createElement("option");
                opt.value = res;
                opt.innerHTML = res;
                r.appendChild(opt);
            });
        } else {
            r.innerHTML = "<option>No Resolutions Found</option>";
        }
    })
    .catch(() => {
        document.getElementById("resolution").innerHTML = "<option>Error</option>";
    });
});


// Update Progress
function updateProgress() {
    fetch("/progress")
        .then(res => res.json())
        .then(data => {
            let percent = data.percentage || 0;
            document.getElementById("percent").innerText = percent + "%";
            document.getElementById("progressFill").style.width = percent + "%";
        });
}

let intervalID;

// Start Download
function startDownload() {
    let url = document.getElementById("url").value;
    let res = document.getElementById("resolution").value;

    if (!url || !res || res === "Select Resolution") {
        alert("Please paste URL and select resolution!");
        return;
    }

    let form = new FormData();
    form.append("url", url);
    form.append("resolution", res);

    intervalID = setInterval(updateProgress, 400);

    fetch("/download", { method: "POST", body: form })
        .then(res => res.blob())
        .then(file => {
            clearInterval(intervalID);

            let a = document.createElement("a");
            a.href = window.URL.createObjectURL(file);
            a.download = "video.mp4";
            a.click();

            document.getElementById("percent").innerText = "0%";
            document.getElementById("progressFill").style.width = "0%";
        })
        .catch(() => {
            clearInterval(intervalID);
            alert("Download Failed!");
        });
}

</script>

</body>
</html>
